const config = require('../../../../config')

const emailAddress = 'donotsend@apvs.com'
const reference = '1234567'
const eligibilityId = '4321'

const mockSendNotification = jest.fn().mockResolvedValue()

jest.mock('../../../../app/services/notify/send-notification', () => mockSendNotification)

const sendMalwareNotification = require('../../../../app/services/workers/send-malware-notification')

describe('services/send-malware-notification', () => {
  it('should call send-notification with correct details', () => {
    return sendMalwareNotification
      .execute({
        reference,
        eligibilityId,
        additionalData: emailAddress,
      })
      .then(() => {
        expect(mockSendNotification).toHaveBeenCalled()
        expect(mockSendNotification.mock.calls[0][0]).toBe(config.NOTIFY_MALWARE_UPLOAD_EMAIL_TEMPLATE_ID)
        expect(mockSendNotification.mock.calls[0][1]).toBe(emailAddress)
        expect(mockSendNotification.mock.calls[0][2].reference).toBe(reference)
      })
  })
})
