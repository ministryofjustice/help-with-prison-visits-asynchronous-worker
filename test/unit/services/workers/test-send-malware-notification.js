const sinon = require('sinon')

const config = require('../../../../config')

const emailAddress = 'donotsend@apvs.com'
const reference = '1234567'
const eligibilityId = '4321'

const stubSendNotification = sinon.stub().resolves()

jest.mock('../notify/send-notification', () => stubSendNotification);

const sendMalwareNotification = require('../../../../app/services/workers/send-malware-notification')

describe('services/send-malware-notification', function () {
  it('should call send-notification with correct details', function () {
    return sendMalwareNotification.execute({
      reference,
      eligibilityId,
      additionalData: emailAddress
    })
      .then(function () {
        expect(stubSendNotification.called).toBe(true) //eslint-disable-line
        expect(stubSendNotification.firstCall.args[0]).toBe(config.NOTIFY_MALWARE_UPLOAD_EMAIL_TEMPLATE_ID)
        expect(stubSendNotification.firstCall.args[1]).toBe(emailAddress)
        expect(stubSendNotification.firstCall.args[2].reference).toBe(reference)
      });
  })
})
